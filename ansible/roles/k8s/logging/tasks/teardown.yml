- name: Remove existing tech logstash svc
  kubernetes.core.k8s:
    state: absent
    api_version: v1
    kind: Service
    namespace: tech
    name: logstash-loadbalancer

- name: Retrieve logging kibana record
  amazon.aws.route53:
    state: get
    zone: "{{ dns.zone }}"
    record: "{{ kibana.suffix + '.' + dns.base_host }}"
    type: A
  register: rec

- name: Remove logging kibana record
  community.aws.route53:
    state: absent
    zone: "{{ dns.zone }}"
    record: "{{ rec.set.record }}"
    type: "{{ rec.set.type }}"
    value: "{{ rec.set.value }}"
    alias: true
    alias_hosted_zone_id: "Z3Q77PNBQS71R4"
  when: rec.set['record'] is defined


